<!DOCTYPE html>
<html lang="zh">
<head>
    {include file="../application/common/view/web/head.html" title=" - 首页"}
    <!--begin::Page Vendors Styles -->
    <link href="/resource/web/assets/vendors/custom/fullcalendar/fullcalendar.bundle.css" rel="stylesheet" type="text/css"/>
</head>
<!-- begin::Body -->
<body class="m-page--fluid m--skin- m-content--skin-light2 m-header--fixed m-header--fixed-mobile m-aside-left--enabled m-aside-left--skin-dark m-aside-left--fixed m-aside-left--offcanvas m-footer--push m-aside--offcanvas-default">
<!-- begin:: Page -->
<div class="m-grid m-grid--hor m-grid--root m-page">

    <!-- BEGIN: Header -->
    {include file="../application/common/view/web/header.html"}

    <!-- END: Header -->

    <!-- begin::Body -->
    <div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-body">

        <!-- BEGIN: Left Aside -->
        {include file="../application/common/view/web/left.html"}

        <!-- END: Left Aside -->
        <div class="m-grid__item m-grid__item--fluid m-wrapper">
            <!-- BEGIN: Subheader -->
            <div class="m-subheader ">
                    <div class="d-flex align-items-center">
                        <div class="mr-auto">
                            <h3 class="m-subheader__title m-subheader__title--separator">广告管理</h3>
                            <ul class="m-subheader__breadcrumbs m-nav m-nav--inline">
                                <li class="m-nav__item m-nav__item--home">
                                    <a href="{:url('Index/index')}" class="m-nav__link m-nav__link--icon">
                                        <i class="m-nav__link-icon la la-home"></i>
                                    </a>
                                </li>
                                <li class="m-nav__separator">-</li>
                                <li class="m-nav__item">
                                    <a href="{:url('Adver/index')}" class="m-nav__link">
                                        <span class="m-nav__link-text">广告管理</span>
                                    </a>
                                </li>
                                <li class="m-nav__separator">-</li>
                                <li class="m-nav__item">
                                    <a href="javascript:void(0);" class="m-nav__link">
                                        <span class="m-nav__link-text">素材列表</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            <!-- END: Subheader -->
            <div class="m-content">
                <div class="m-portlet m-portlet--full-height">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-tools">
                            <ul class="nav nav-pills nav-pills--brand m-nav-pills--align-right m-nav-pills--btn-pill m-nav-pills--btn-sm" role="tablist">
                                <li class="m-portlet__nav-item">
                                    <a href="{:url('adver/addAdver')}" class="btn btn-info m-btn m-btn--custom m-btn--pill m-btn--icon m-btn--air">
                                        <span><i class="la la-plus"></i><span>上传素材</span></span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="m-portlet__head-tools">
                            <form action="" method="get" class="form-inline ">
                                <div class="form-group mr-2">
                                    <input type="text" name="name" id="name" class="form-control form-control-sm m-input--solid"  value="{$name}" placeholder="广告名称">
                                </div>
                                <div class="form-group mr-2">
                                    <select class="form-control form-control-sm m-input--solid" id="type" name="type">
                                        <option value="0">广告类型</option>
                                        <option value="1">图片</option>
                                        <option value="2">视频</option>
                                        <option value="3">图片 + 视频</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <input type="submit" class="btn btn-info btn-sm" name="supplier_mobile" value="搜索">
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <div class="tab-content" style="overflow: hidden">
                            <div class="m-portlet__body">

                                <!--begin::Content-->
                                {volist name="adver_list" id="adv"}
                                <div class="tab-content">
                                    <div class="tab-pane active" id="m_widget5_tab1_content" aria-expanded="true">

                                        <!--begin::m-widget5-->
                                        <div class="m-widget5">
                                            <div class="m-widget5__item">
                                                <div class="m-widget5__content">
                                                    <div class="m-widget5__pic">
                                                        {switch name="adv.resource_adver_type"}
                                                        {case value="1"}
                                                            <img src="{$adv.resource_img_path}" style="width: 150px;height: 100px;" alt="{$adv.resource_name}"/>
                                                        {/case}
                                                        {case value="2"}
                                                            <video class="videoContent" controls poster="{$adv.resource_video_path}" style="width: 150px;height: 100px;">
                                                                <source src="{$adv.resource_video_path}" type="video/mp4"/>
                                                            </video>
                                                        <!--<video src="{$adv.resource_video_path}" width="150" height="100" alt="{$adv.resource_name}" controls></video>-->
                                                        {/case}
                                                        {default}
                                                            <img src="{$adv.resource_img_path}" style="width: 150px;height: 100px;"  alt="{$adv.resource_name}"/>
                                                        {/switch}
                                                    </div>
                                                    <div class="m-widget5__section">
                                                        <h4 class="m-widget5__title">
                                                            名称 : <span class="m-widget5__info-date m--font-info">{$adv.resource_name}</span>
                                                        </h4>
                                                        <h4 class="m-widget5__title">
                                                            投放类型 : <span class="m-widget5__info-date m--font-info"> {switch name="adv.resource_put_type"}
                                                                            {case value="1"}不分屏机器{/case}
                                                                            {case value="2"}分屏机器{/case}
                                                         {/switch}</span>
                                                        </h4>
                                                        <h4 class="m-widget5__title">
                                                            素材类型 : <span class="m-widget5__info-date m--font-info"> {switch name="adv.resource_adver_type"}
                                                                            {case value="1"}图片{/case}
                                                                            {case value="2"}视频{/case}
                                                                            {default}图片 + 视频
                                                          {/switch}</span>
                                                        </h4>
                                                        <h4 class="m-widget5__title" id="status_{$adv.resource_id}">
                                                            素材状态 : {switch name="adv.resource_status"}
                                                            {case value="1"}<span class="m-badge  m-badge--success m-badge--wide">使用中</span>{/case}
                                                            {case value="2"}<span class="m-badge  m-badge--danger m-badge--wide">已下架</span>{/case}
                                                            {default}
                                                            {/switch}
                                                        </h4>
                                                    </div>
                                                </div>
                                                <div class="m-widget5__content" style="z-index: 100;">
                                                    <div class="m-widget5__stats1">
                                                        <span class="m-widget5__sales">
                                                            <div class="dropdown">
																	<button class="btn btn-info dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
																		操作
																	</button>
																	<div class="dropdown-menu" aria-labelledby="dropdownMenu2" x-placement="bottom-start" style="position: absolute;will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 41px, 0px);">
																		{switch name="adv.resource_status"}
                                                            {case value="1"}<a class="dropdown-item" href="javascript:void(0);"
                                                                               onclick="Resource(this,'{$adv.resource_id}','{$adv.resource_name}',1)"><i class="flaticon-download"></i> 下架素材 </a>{/case}
                                                            {case value="2"}<a class="dropdown-item" href="javascript:void(0);"
                                                                               onclick="Resource(this,'{$adv.resource_id}','{$adv.resource_name}',2)"><i class="fa fa-cloud-upload"></i> 上架素材 </a>{/case}

                                                            {/switch}

                                                            <a class="dropdown-item" href="javascript:void(0);" onclick="delAdver(this,'{$adv.resource_id}','{$adv.resource_name}')"><i class="flaticon-delete"></i> 删除素材 </a>
																	</div>
                                                            </div>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!--end::m-widget5-->
                                    </div>
                                </div>
                                {/volist}
                                <!--end::Content-->
                            </div>
                            <div class="dataTables_wrapper">
                            <div class="dataTables_pager">
                                <div class="dataTables_paginate paging_simple_numbers"> {$adver_list->render();}</div>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- end:: Body -->

    <!-- begin::Footer -->
    {include file="../application/common/view/web/footer.html"}
    <!-- end::Footer -->
</div>

<!-- end:: Page -->

<!-- begin::Scroll Top -->
<div id="m_scroll_top" class="m-scroll-top">
    <i class="la la-arrow-up"></i>
</div>

<!-- end::Scroll Top -->


<!--begin::Global Theme Bundle -->
<script src="/resource/web/assets/vendors/base/vendors.bundle.js" type="text/javascript"></script>
<script src="/resource/web/assets/demo/default/base/scripts.bundle.js" type="text/javascript"></script>

<!--end::Global Theme Bundle -->

<!--begin::Page Vendors -->
<script src="/resource/web/assets/vendors/custom/fullcalendar/fullcalendar.bundle.js" type="text/javascript"></script>

<!--end::Page Vendors -->

<!--begin::Page Scripts -->
<script src="/resource/web/assets/app/js/dashboard.js" type="text/javascript"></script>
<!--end::Page Scripts -->
<script>
    setValue("type",'{$type}');
    nav_url = "{:url('adver/index')}";
    /**
     * 删除素材
     * @param node
     * @param id
     * @param name
     */
    function delAdver(node,id,name) {
        Swal.fire({
            title: '删除素材',
            text: '是否删除 “'+name+'” 素材?',
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: '确定',
            cancelButtonText: '取消',
        }).then((result) => {
            if (result.value) {
                $.ajax({
                    url:"{:url('delAdver')}",
                    type:"POST",
                    data:{id:id},
                    success:function (resData) {
                        if(resData["state"] == 200){
                            toastr.success(resData["msg"]);
                            setTimeout(function () {
                                location.reload();
                            },2000);
                        }else{
                            toastr.warning(resData["msg"]);
                        }
                    },error:function (error) {
                        toastr.warning("删除素材失败，网络异常");
                    }
                });
            }else{
                toastr.info("已取消删除素材！");
            }
        })
    }

    /**
     * 上/下架素材
     * @param node
     * @param id
     * @param name
     * @param type
     * @constructor
     */
    function Resource(node,id,name,type) {
        var nextNode = $(node).next('a');
        var oldNode = nextNode.parent();
        if(type==1){
           var title = '下架素材';
           var text = '确定下架 “'+name+'” 素材？';
           var errorText = '下架素材失败，网络异常';
           var cancelText = '已取消下架素材';
           var updateText = '素材状态 : <span class="m-badge  m-badge--danger m-badge--wide">已下架</span>';
           var newNode = '<a class="dropdown-item" href="javascript:void(0);"  onclick="Resource(this,'+id+',\''+name+'\',2);"><i class="flaticon-download"></i> 上架素材 </a>';
        }else{
            var title = '上架素材';
            var text = '确定上架 "'+name+'" 素材？';
            var errorText = '上架素材失败，网络异常';
            var cancelText = '已取消上架素材';
            var updateText = '素材状态 : <span class="m-badge  m-badge--success m-badge--wide">使用中</span>';
            var newNode = '<a class="dropdown-item" href="javascript:void(0);" onclick="Resource(this,'+id+',\''+name+'\',1);"><i class="flaticon-download"></i> 下架素材 </a>';
        }
        Swal.fire({
            title: title,
            text: text,
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: '确定',
            cancelButtonText: '取消',
        }).then((result) => {
            if (result.value) {
                $.ajax({
                    url:"{:url('resource')}",
                    type:"POST",
                    data:{id:id,type:type},
                    success:function (resData) {
                        if(resData["state"] == 200){
                            // console.log("status",oldNode);
                            // node.text(updateText);
                            // oldNode.removeChild(node);
                            $(node).remove();
                            $("#status_"+id).empty();
                            $("#status_"+id).append(updateText);
                            nextNode.before(newNode);
                            toastr.success(resData["msg"]);
                        }else{
                            toastr.warning(resData["msg"]);
                        }
                    },error:function (error) {
                        toastr.warning(errorText);
                    }
                });
            }else{
                toastr.info(cancelText);
            }
        })
    }
</script>
</body>

<!-- end::Body -->
</html>